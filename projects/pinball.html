<html>
<head>
	<link rel="stylesheet" href="/style.css">
	<title>Pinball</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script type="text/javascript" src="https://static.codehs.com/gulp/a207eaf74c9a65ef1504f82657de97532616341f/chs-js-lib/chs.js"></script>
</head>

<body>
	<p align = "center">
		<canvas width="400" height="600" class="codehs-editor-canvas" style="background-color:lightgray"></canvas> 
	</p>
	
<script>
window.onload = function() {
	removeAll();
	stopAllTimers();
	
	var ballSpaceWidth = 25; 
	var lPaddle, rPaddle;
	var paddleWidth = 75, paddleHeight = 10, paddleXSpacing = 115, paddleYSpacing = getHeight() - 50;
	var paddleColor = Color.purple;
	var ball;
	var ballRadius = 10, ballColor = Color.white, ballDX = 0, ballDY = 0, ballSpd = 5;
	var ballHasMoved = false;
	var bumperColor = paddleColor, bumpEdgeWidth = 10;
	
	function start() {
		createBackground();
		addBall();
		addPaddles();
		keyUpMethod(paddleReset);
		keyDownMethod(paddleMove);
	}
	
	function addPaddles() {
		lPaddle = new Rectangle(paddleWidth, paddleHeight); rPaddle = new Rectangle(paddleWidth, paddleHeight);
		lPaddle.setPosition(0 + paddleXSpacing - ballSpaceWidth, paddleYSpacing); 
		rPaddle.setPosition(getWidth() - paddleXSpacing - paddleWidth - ballSpaceWidth, paddleYSpacing);
		lPaddle.setColor(paddleColor); rPaddle.setColor(paddleColor);
		add(lPaddle); add(rPaddle);
	}
	function addBall() {
		ball = new Circle(ballRadius);
		ball.setPosition(getWidth() - ballSpaceWidth/2, getHeight() - ballRadius);
		ball.setColor(ballColor);
		add(ball);
	}
	function paddleReset() {
		lPaddle.setRotation(45);
		rPaddle.setRotation(-45);
	}
	function paddleMove(e) {
		if (e.keyCode == Keyboard.LEFT || e.keyCode == Keyboard.letter('A')) {
			lPaddle.setRotation(-45);	
		}
		else if (e.keyCode == Keyboard.RIGHT || e.keyCode == Keyboard.letter('D')) {
			rPaddle.setRotation(45);	
		}
		else if (e.keyCode == Keyboard.SPACE || e.keyCode == Keyboard.DOWN || e.keyCode == Keyboard.letter('S')) {
			if (ballHasMoved == false) {
				setTimer(initialBall, 1);
				setTimer(ballMove, 1); 
			}
		}
	}
	function initialBall() {
		ballHasMoved = true;
		if (ball.getY() - ball.getRadius() > 0) {
			ball.move(0, -ballSpd);
		}
		else if (ball.getX() - ball.getRadius() > 0) {
			ball.move(-ballSpd, 0);
		}
		else { stopTimer(initialBall); }
	}
	function ballMove() {
		collide();
		ball.move(ballDX * 2, ballDY * 3); // width = 400, height = 600, scale 2/3
	}
	function collide() {
		var topLeft = getElementAt(ball.getX() - ball.getRadius(), ball.getY() - ball.getRadius());
		var topRight = getElementAt(ball.getX() + ball.getRadius(), ball.getY() - ball.getRadius());
		var botLeft = getElementAt(ball.getX() - ball.getRadius(), ball.getY() + ball.getRadius());
		var botRight = getElementAt(ball.getX() + ball.getRadius(), ball.getY() + ball.getRadius());
		if (topLeft != null && topLeft.getColor() == bumperColor) {
			ballDX = ballSpd; ballDY = ballSpd; 
		}
		else if (topRight != null && topRight.getColor() == bumperColor) {
			ballDX = -ballSpd; ballDY = ballSpd;
		}
		else if (botLeft != null && botLeft.getColor() == bumperColor) {
			ballDX = ballSpd; ballDY = -ballSpd;
		}
		else if (botRight != null && botRight.getColor() == bumperColor) {
			ballDX = -ballSpd; ballDY = -ballSpd;
		}
	}
	
	function createBackground() {
		var leftBumpEdge = new Rectangle(bumpEdgeWidth, getHeight());
		leftBumpEdge.setColor(bumperColor);
		leftBumpEdge.setPosition(0, 0); 
		add(leftBumpEdge);
		var rightBumpEdge = new Rectangle(bumpEdgeWidth, getHeight());
		rightBumpEdge.setColor(bumperColor);
		rightBumpEdge.setPosition(getWidth() - ballSpaceWidth - bumpEdgeWidth, 0); 
		add(rightBumpEdge);
		var botBumpEdge = new Rectangle(getWidth(), bumpEdgeWidth);
		botBumpEdge.setColor(bumperColor);
		botBumpEdge.setPosition(0 + bumpEdgeWidth, getHeight() - bumpEdgeWidth); 
		add(botBumpEdge);
		var ballArea = new Rectangle(ballSpaceWidth, getHeight());
		ballArea.setColor(new Color(222, 184, 135));
		ballArea.setBorderColor(Color.black);
		ballArea.setPosition(getWidth() - ballSpaceWidth, 0);
		add(ballArea);
		var topBallArea = new Rectangle(getWidth(), ballSpaceWidth);
		topBallArea.setColor(new Color(222, 184, 135));
		topBallArea.setBorderColor(Color.black);
		topBallArea.setPosition(0, 0);
		add(topBallArea);
		var ballAreaCorner = new Circle(ballSpaceWidth);
		ballAreaCorner.setColor(bumperColor);
		ballAreaCorner.setPosition(0, 0);
		add(ballAreaCorner);
	}
	
	if (typeof start == 'function')
		start();
}
</script>
	
</body>
</html>
