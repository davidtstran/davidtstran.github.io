<html>
<head>
	<link rel="stylesheet" href="/style.css">
	<title>Weather</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script type="text/javascript" src="https://static.codehs.com/gulp/a207eaf74c9a65ef1504f82657de97532616341f/chs-js-lib/chs.js"></script>
</head>
<body>
	<header>(<a href = "https://davidtstran.github.io" style="color:darkgray">Home</a>)
		David Tran Header
		(<a href = "https://github.com/davidtstran" style="color:darkgray">GitHub</a>) </header> <br> <br>
	<h2>Weather Refreshes Every 10 Minutes<br>
	    Data from OpenWeatherMap<br></h2>
	<h2 id = "displayW">-</h2>
	<p align = "center">
		<canvas width="500" height="500" class="codehs-editor-canvas" style="background-color:black"></canvas>
	</p>
	
<script>
window.onload = function() {
	removeAll();
	var BUFFER = 10;
	var dayNight; // day true, night false 
	var sunMoon;
	var dayColor = new Color(135,206,235), nightColor = new Color(25,25,112); // skyblue | midnightblue
	var sunColor = new Color(255,255,51), moonColor = new Color(255,255,240); // lightyellow4 | ivory 
	var cloudSection;
	var cloudColor = new Color(220,220,220);
	var precipit; // (Clear/Clouds/Rain/Thunderstorm/Snow)
	var weatherJSON;
	var elementsArray = [];
	
	function start() {
		displayWeather();
		setTimer(displayWeather, 600000); // 60000 = minute
	}
	
    function gettingJSON(){
		var weatherLink = "https://api.openweathermap.org/data/2.5/weather?id=4393217&appid=13c9e93b7a505729f5d267751fde0e41";
        $.getJSON(weatherLink,function(json){
			weatherJSON = json;
			// document.write(JSON.stringify(json)); // full JSON string
			elementsArray[0] = weatherJSON.name; // city name
			elementsArray[1] = weatherJSON.main.temp; // temperature default Kelvin
			elementsArray[1] = 9/5 * (parseFloat(elementsArray[1]) - 273.15) + 32 // convert temp to Fahrenheit
			elementsArray[2] = weatherJSON.weather[0].main; // weather (Clear/Clouds/Rain/Thunderstorm/Snow)
			document.getElementById("displayW").innerHTML = elementsArray[0] + " " + elementsArray[1].toFixed(2) + "Â°F " + elementsArray[2];
        });
    }
	
	function displayWeather() {
		gettingJSON();
		var currDate = new Date();
		if (currDate.getHours() >= 7 && currDate.getHours() < 20) { dayNight = true; }
		else { dayNight = false; }
		precipit = elementsArray[2];
		
		background(dayNight);
		setTimer(precipitate, 150, precipit);
		cloudCreate(precipit);
	}
	function background(dN) { // true if day, false if night
		var background = new Rectangle(getWidth(), getHeight());
		sunMoon = new Circle(30);
		sunMoon.setPosition(getWidth() - sunMoon.getRadius() - BUFFER, sunMoon.getRadius() + BUFFER);  // top right
		if (dN) { background.setColor(dayColor); sunMoon.setColor(sunColor); add(background); add(sunMoon); }
		else { 
			background.setColor(nightColor); sunMoon.setColor(moonColor); 
			add(background); add(sunMoon);
			for (var i = 0; i < 20; i++) { 
				var star = new Circle(2); 
				star.setColor(moonColor);
				star.setPosition(Randomizer.nextInt(0, getWidth()), Randomizer.nextInt(0, getHeight()/2)); 
				add(star);
			}
		}
	}
	function cloudCreate(p) { // true if clear, false if cloudy
		var cloudCount = Randomizer.nextInt(10, 20), cloudRadius = (getWidth()/2)/cloudCount;
		var cloudY = sunMoon.getY() + sunMoon.getRadius();
		if (p != "Clear") {
			cloudSection = new Rectangle(getWidth(), cloudRadius);
			cloudSection.setPosition(0, cloudY);
			cloudSection.setColor(cloudColor); add(cloudSection);
			for (var i = 0; i < cloudCount; i ++) {
				var cloud = new Circle(cloudRadius);
				cloud.setColor(cloudColor);
				cloud.setPosition(cloudRadius + cloudRadius*2*i, cloudY);
				add(cloud);
			}
		}
	}
	function precipitate(p) { // RAIN 0, SNOW 1, ELSE NONE
		var precipColor, precipRadius = 5; 
		if (p == "Rain") { precipColor = Color.blue; }
		else if (p == "Snow") { precipColor = Color.white; }
		for (var i = 0; i < getWidth()/(precipRadius*2); i++) {
			var drop = new Circle(precipRadius);
			drop.setPosition(precipRadius + precipRadius*2*i, cloudSection.getY() + cloudSection.getHeight());
			drop.setColor(precipColor); add(drop);
			setTimer(dropFall, 1, drop);
		}
	}
	function dropFall(dp) {
		if (dp.getY() > getHeight())
			remove(dp);
		else {
			var dropSpeed = Randomizer.nextFloat(10, 100);
			dp.setPosition(dp.getX(), dp.getY() + dropSpeed);
		}
	}
	
	if (typeof start === 'function') {
        	start();
    	}
}
</script>
	
	<br> <br> <br>
	<footer>(<a href = "https://davidtstran.github.io" style="color:darkgray">Home</a>)
		David Tran Footer
		(<a href = "https://github.com/davidtstran" style="color:darkgray">GitHub</a>) </footer> 
</body>
</html>

